  ## Test to check that our approach reaches the same likelihood than HiSSE.
  # to calculate likelihood of a trait with 2 states using Hisse
  # pars <- c(0.1, 0.2, 0.03, 0.03, 0.01, 0.01)
  # set.seed(4); phy <- ape::rcoal(52)
  
# This next paste is very messy, but at least it is hardcoded in this script.
# Enjoy scrolling down ;)

ref_states_y1 <- c(0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,
                   0.0000000000000000,0.0000000000000000,0.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,1.0000000000000000,0.0000000000000000,
                   0.0492456700000000,0.0301850000000000,0.0299980700000000,0.0396037400000000,0.2824201000000000,0.0871020300000000,0.1762305000000000,0.4542473000000000,
                   0.0221704100000000,0.0102002700000000,0.0101669700000000,0.0161744700000000,0.0940616400000000,0.0034558650000000,0.0069508410000000,0.8955317000000000,
                   0.0059604990000000,0.0021826510000000,0.0021805570000000,0.0040713710000000,0.4101835000000000,0.0371365500000000,0.0551462000000000,0.4975338000000000,
                   0.0010882530000000,0.0003691786000000,0.0003691120000000,0.0007287147000000,0.3074474000000000,0.1540310000000000,0.2309621000000000,0.3075595000000000,
                   0.0037285900000000,0.0013189650000000,0.0013181630000000,0.0025237280000000,0.3693351000000000,0.1085366000000000,0.0719066200000000,0.4502217000000000,
                   0.0006985062000000,0.0002354800000000,0.0002354527000000,0.0004669928000000,0.8046363000000000,0.0005039098000000,0.1928421000000000,0.0020176600000000,
                   0.0003927917000000,0.0001317660000000,0.0001317574000000,0.0002622788000000,0.3076040000000000,0.1539128000000000,0.2308389000000000,0.3076443000000000,
                   0.0004397900000000,0.0001476441000000,0.0001476333000000,0.0002937170000000,0.7026181000000000,0.0000063690300000,0.2973540000000000,0.0000215839700000,
                   0.0002143494000000,0.0000716984300000,0.0000716958700000,0.0001430239000000,0.6383873000000000,0.0004572235000000,0.3593280000000000,0.0018274260000000,
                   0.0001967091000000,0.0000657790800000,0.0000657769200000,0.0001312441000000,0.3076481000000000,0.1538795000000000,0.2308041000000000,0.3076683000000000,
                   0.0015121460000000,0.0005164762000000,0.0005163472000000,0.0010143080000000,0.0002761567000000,0.3338434000000000,0.0002074313000000,0.6656730000000000,
                   0.0211552000000000,0.0096065630000000,0.0095764730000000,0.0153714500000000,0.0979286900000000,0.0124379800000000,0.0175828500000000,0.8720505000000000,
                   0.0078177910000000,0.0029446250000000,0.0029409580000000,0.0053807460000000,0.3875620000000000,0.0141362400000000,0.0156443700000000,0.5826574000000000,
                   0.0069892920000000,0.0025998310000000,0.0025969230000000,0.0047942320000000,0.9118551000000000,0.0020033190000000,0.0438687400000000,0.0422728900000000,
                   0.0027312710000000,0.0009511292000000,0.0009507032000000,0.0018411810000000,0.3872950000000000,0.0543061400000000,0.1704087000000000,0.3879901000000000,
                   0.0001982414000000,0.0000662931200000,0.0000662909300000,0.0001322672000000,0.3076477000000000,0.1538798000000000,0.2308044000000000,0.3076681000000000,
                   0.0001467422000000,0.0000490305700000,0.0000490293800000,0.0000978864000000,0.3076593000000000,0.1538710000000000,0.2307953000000000,0.3076744000000000,
                   0.0049891290000000,0.0017998350000000,0.0017983810000000,0.0033943630000000,0.8685409000000000,0.0038141680000000,0.1017185000000000,0.0259264100000000,
                   0.0027932090000000,0.0009736508000000,0.0009732050000000,0.0018834090000000,0.3070631000000000,0.1543214000000000,0.2312628000000000,0.3073528000000000,
                   0.0036257550000000,0.0012805240000000,0.0012797660000000,0.0024530940000000,0.8218122000000000,0.0039804700000000,0.1592524000000000,0.0149548700000000,
                   0.0001837333000000,0.0000614270900000,0.0000614252100000,0.0001225802000000,0.3076510000000000,0.1538773000000000,0.2308018000000000,0.3076698000000000,
                   0.0016872930000000,0.0005779131000000,0.0005777522000000,0.0011325990000000,0.7561161000000000,0.0000388615700000,0.2436183000000000,0.0002267414000000,
                   0.0005470739000000,0.0001839793000000,0.0001839626000000,0.0003655264000000,0.5711345000000000,0.0000153212500000,0.4288196000000000,0.0000306257300000,
                   0.0014469560000000,0.0004936954000000,0.0004935774000000,0.0009703231000000,0.6280748000000000,0.0031248710000000,0.3565527000000000,0.0122476200000000,
                   0.0006187754000000,0.0002083332000000,0.0002083118000000,0.0004135541000000,0.3075531000000000,0.1539512000000000,0.2308790000000000,0.3076167000000000,
                   0.0042847120000000,0.0015289090000000,0.0015278440000000,0.0029067350000000,0.0017903580000000,0.2069490000000000,0.0013476150000000,0.7899130000000000,
                   0.0006041314000000,0.0002033547000000,0.0002033343000000,0.0004037428000000,0.0000435908100000,0.3335763000000000,0.0000327128800000,0.6663474000000000,
                   0.0077079280000000,0.0028984490000000,0.0028948880000000,0.0053027450000000,0.0331863700000000,0.0112047500000000,0.0021224100000000,0.9534865000000000,
                   0.0046925410000000,0.0016850810000000,0.0016837990000000,0.0031887120000000,0.4023073000000000,0.0039015530000000,0.0136225100000000,0.5801687000000000,
                   0.0034016500000000,0.0011971590000000,0.0011964940000000,0.0022993670000000,0.0032191130000000,0.0062840770000000,0.0018627740000000,0.9886340000000000,
                   0.0003783743000000,0.0001268999000000,0.0001268919000000,0.0002526371000000,0.1579013000000000,0.1450210000000000,0.1182551000000000,0.5788225000000000,
                   0.0002420765000000,0.0000810093000000,0.0000810060400000,0.0001615429000000,0.0000069669750000,0.3334368000000000,0.0000052264970000,0.6665510000000000,
                   0.0019382280000000,0.0006665222000000,0.0006663094000000,0.0013023680000000,0.0003204758000000,0.0341927600000000,0.0001793741000000,0.9653074000000000,
                   0.0012315170000000,0.0004187407000000,0.0004186554000000,0.0008251270000000,0.0069722810000000,0.0610548100000000,0.0039570150000000,0.9280159000000000,
                   0.0001633870000000,0.0000546067600000,0.0000546052700000,0.0001089969000000,0.3076556000000000,0.1538739000000000,0.2307982000000000,0.3076723000000000,
                   0.0003455963000000,0.0001158454000000,0.0001158387000000,0.0002307208000000,0.0000126597900000,0.2006552000000000,0.0000094981070000,0.7993226000000000,
                   0.0000038822650000,0.0000012941700000,0.0000012941690000,0.0000025882180000,0.0000000017863990,0.3333351000000000,0.0000000013398050,0.6666649000000000,
                   0.0026980470000000,0.0009390662000000,0.0009386506000000,0.0018185380000000,0.9611106000000000,0.0007753182000000,0.0349148100000000,0.0031992250000000,
                   0.0022110280000000,0.0007636399000000,0.0007633622000000,0.0014873240000000,0.3071944000000000,0.1542221000000000,0.2311603000000000,0.3074232000000000,
                   0.0022772200000000,0.0007873282000000,0.0007870334000000,0.0015322630000000,0.9420554000000000,0.0000837227200000,0.0576363000000000,0.0002246033000000,
                   0.0004493363000000,0.0001508722000000,0.0001508610000000,0.0003001042000000,0.6919808000000000,0.0046965850000000,0.2926693000000000,0.0106533700000000,
                   0.0004426092000000,0.0001485973000000,0.0001485864000000,0.0002956032000000,0.6394691000000000,0.0000070224580000,0.3605099000000000,0.0000140449400000,
                   0.0001263041000000,0.0000421876600000,0.0000421867800000,0.0000842458800000,0.5713653000000000,0.0000008117710000,0.4286322000000000,0.0000016233370000,
                   0.0013945050000000,0.0004753999000000,0.0004752903000000,0.0009349499000000,0.8461009000000000,0.0000071551890000,0.1538774000000000,0.0000144565300000,
                   0.0003610913000000,0.0001210697000000,0.0001210624000000,0.0002410805000000,0.6395705000000000,0.0000046306800000,0.3604156000000000,0.0000092615260000,
                   0.0001050774000000,0.0000350855300000,0.0000350849100000,0.0000700814600000,0.5713761000000000,0.0000005616748000,0.4286222000000000,0.0000011232320000,
                   0.0012364280000000,0.0004204439000000,0.0004203579000000,0.0008284343000000,0.7015831000000000,0.0000103017700000,0.2983853000000000,0.0000213269900000,
                   0.0010760290000000,0.0003649599000000,0.0003648949000000,0.0007204932000000,0.6386799000000000,0.0000404425400000,0.3611987000000000,0.0000809031600000,
                   0.0003351050000000,0.0001123096000000,0.0001123033000000,0.0002237073000000,0.5712547000000000,0.0000057313570000,0.4287281000000000,0.0000114588700000,
                   0.0033922930000000,0.0011936900000000,0.0011930290000000,0.0022929550000000,0.0014196920000000,0.3340048000000000,0.0010683970000000,0.6635071000000000,
                   0.0012719620000000,0.0004327735000000,0.0004326825000000,0.0008523660000000,0.5706632000000000,0.0000836645800000,0.4290861000000000,0.0001671161000000)

ref_states_y1 <- matrix(ref_states_y1, ncol = 8, nrow = 103,
                           byrow= TRUE)



  newickphy <- "((((t15:0.03654175604,t36:0.03654175604):0.1703092581,(((t42:0.01312768801,t23:0.01312768801):0.01026551964,(((t19:0.006565648042,t5:0.006565648042):0.000589637007,t35:0.007155285049):0.0075478055,t51:0.01470309055):0.008690117099):0.1040593382,(t20:0.05092066659,t16:0.05092066659):0.07653187925):0.07939846827):0.6519637868,(((((t43:0.006616860045,t3:0.006616860045):0.08611719299,(t48:0.004896235936,t40:0.004896235936):0.0878378171):0.1515206506,((t44:0.09487672192,t2:0.09487672192):0.07712689077,((t37:0.006132013467,t32:0.006132013467):0.1177191576,((t46:0.01830302153,t21:0.01830302153):0.03858278382,((t25:0.02071187578,t24:0.02071187578):0.02799215338,t47:0.04870402916):0.008181776188):0.06696536571):0.04815244163):0.07225109099):0.03049659492,((t6:0.02021971253,t45:0.02021971253):0.1267950773,t18:0.1470147899):0.1277365087):0.5391698492,(((((t27:0.008082361089,t17:0.008082361089):0.00456225043,t39:0.01264461152):0.103375347,(t7:0.06545659749,((t26:0.005452218586,t12:0.005452218586):0.03594003265,((t13:0.0001294122247,t9:0.0001294122247):0.01141726784,t31:0.01154668006):0.02984557118):0.02406434625):0.05056336106):0.04543362477,((t34:0.0748070545,t11:0.0748070545):0.01677840675,(((t38:0.01479762241,(t41:0.004213712966,t14:0.004213712966):0.01058390944):0.000225587269,t4:0.01502320968):0.06205778867,((t49:0.01206564111,(t10:0.00350505531,t52:0.00350505531):0.008560585803):0.03485629493,(t28:0.04155870788,((t8:0.01119536676,t22:0.01119536676):0.02493294048,t50:0.03612830725):0.005430400635):0.005363228164):0.0301590623):0.01450446291):0.06986812207):0.1092343488,(t1:0.1156934975,t30:0.1156934975):0.1549944346):0.5432332157):0.04489365312):1.400701854,(t29:0.04276331213,t33:0.04276331213):2.216753343);" # nolint
  phy <- phytools::read.newick(text = newickphy)
  testit::assert(!is.null(phy))
  traits <- c(0, 1, 1, 0, 1, 0, 0, 0, 1, 1, 0,
              1, 0, 1, 1, 0, 1, 0, 0, 0, 0, 1,
              0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1,
              1, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0,
              0, 0, 0, 0, 1, 1, 0, 0)
  
  b <- c(0.04, 0.02, 0.03, 0.04)# lambda
  d <- c(0.03, 0.01, 0.01, 0.02)  # Mu
  userTransRate <- 0.2 # transition rate among trait states
  
  ## Now our equivalent version, with only 2 states
  num_concealed_states <- 2
  sampling_fraction <- c(1, 1)
  toCheck <- id_paramPos(traits, num_concealed_states)
  toCheck[[1]][] <- b
  toCheck[[2]][] <- d
  toCheck[[3]][, ] <- userTransRate
  diag(toCheck[[3]]) <- NA
  root_state_weight <- "maddison_weights"
  
  cond <- "maddison_cond"
  y1 <- secsse_loglik(parameter = toCheck,
                                       phy = phy,
                                       traits = traits,
                                       num_concealed_states =
                                         num_concealed_states,
                                       cond = cond,
                                       root_state_weight = root_state_weight,
                                       sampling_fraction = sampling_fraction)
  
  testthat::expect_equal(-237.8611, y1$LL, tolerance = 0.001)
  
  ref_loglik <- -240.1301
  ref_nodeM <- c(0.04924567, 0.03018500, 0.02999807, 0.03960374, 0.29826395, 0.21106779, 0.28434080,0.20632747)
  ref_mergeBranch <- c(0.28242015, 0.08710203, 0.17623055, 0.45424727)
  testthat::expect_equal(y1$loglik, ref_loglik, tolerance = 1e-5)
  testthat::expect_equal(y1$nodeM, ref_nodeM)
  testthat::expect_equal(y1$mergeBranch, ref_mergeBranch)
  testthat::expect_equal(y1$states, ref_states_y1, tolerance = 1e-5)
  for (i in 1:nrow(y1$states)) {
    if (!(all.equal(y1$states[i, ], ref_states_y1[i, ]) == TRUE)) {
      cat(i, "\n")
    }
  }
  
  ## Now with different sampling_fraction
  sampling_fraction <- c(0.8, 1)
  y2 <- secsse_loglik(parameter = toCheck,
                                       phy = phy,
                                       traits = traits,
                                       num_concealed_states =
                                         num_concealed_states,
                                       cond = cond,
                                       root_state_weight = root_state_weight,
                                       sampling_fraction = sampling_fraction)
  
  
  testthat::expect_equal(-243.8611, y2$LL, tolerance = 0.001)
  ref_loglik <- -246.3208 
  ref_nodeM <- c(0.1519936, 0.1065253, 0.1362097, 0.1142819, 0.2992287, 0.210338, 0.2843923, 0.206041)
  ref_mergeBranch <- c(0.284757, 0.08658977, 0.176273, 0.4523802)
  testthat::expect_equal(y2$loglik, ref_loglik, tolerance = 1e-5)
  testthat::expect_equal(y2$nodeM, ref_nodeM, tolerance = 1e-5)
  testthat::expect_equal(y2$mergeBranch, ref_mergeBranch, tolerance = 1e-5)
  